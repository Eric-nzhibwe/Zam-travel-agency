<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Profile - Zam-Travel</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  html, body { height: 100%; }
  body { min-height: 100vh; display: flex; flex-direction: column; background: #f4f8fb; font-family: 'Segoe UI', Arial, sans-serif; }
  main { flex: 1 0 auto; }

  .profile-container { max-width: 400px; margin: 60px auto 0; background: #fff; border-radius: 12px; padding: 2.5rem 2rem; text-align: center; box-shadow:0 2px 12px rgba(0,0,0,0.08);}
  .profile-container h1 { margin-bottom: 1.5rem; color: lightslategray; }

  .btn-primary, .btn-logout { display: inline-block; margin: 0.5em 0.2em; padding: 0.7em 1.5em; border: none; border-radius: 5px; background: darkgray; color: black; cursor: pointer; text-decoration: none; transition: background 0.2s; }
  .btn-primary:hover, .btn-logout:hover { background: lightslategray; }

  .card img { object-fit: cover; }

  .preference-badge { font-size: 0.8em; margin-left: 0.3em; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark py-2 shadow-sm">
  <div class="container d-flex justify-content-between align-items-center">
    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <img src="./logo/Zam-Travel.png" alt="Logo" width="28" height="28" class="me-2">
      <span class="fw-semibold">Zam-Travel</span>
    </a>
    <a href="index.html" class="btn btn-outline-light btn-sm">Home</a>
  </div>
</nav>

<main class="py-4">
  <div class="container">
    <!-- Profile Overview -->
    <div class="row g-4">
      <div class="col-12 col-lg-4">
        <!-- Avatar Card -->
        <div class="card shadow-sm text-center">
          <div class="card-body">
            <img id="avatarImg" src="https://via.placeholder.com/96x96.png?text=%F0%9F%91%A4" alt="Avatar" style="width:96px;height:96px;border-radius:50%;" class="mb-3">
            <h5 class="mb-0" id="profileNameCard">John Doe</h5>
            <div class="text-muted" id="profileEmailCard">john.doe@example.com</div>
            <div class="text-muted" id="profilenumberCard">+260 123 456 789</div>
            <div class="d-grid gap-2 mt-3">
              <label class="btn btn-outline-secondary btn-sm mb-0">
                <i class="fas fa-camera me-1"></i> Change Avatar
                <input id="avatarInput" type="file" accept="image/*" hidden>
              </label>
              <button id="logoutBtn2" class="btn btn-outline-danger btn-sm"><i class="fas fa-sign-out-alt me-1"></i> Logout</button>
            </div>
          </div>
        </div>

        <!-- Preferences Card -->
        <div class="card shadow-sm mt-3">
          <div class="card-body">
            <h6 class="text-uppercase text-muted mb-2">Preferences</h6>
            <div class="small">Seat: <span id="prefSeatView">Window</span></div>
            <div class="small">Meal: <span id="prefMealView">Vegetarian</span></div>
            <div class="small">Email notif: <span id="prefEmailView">On</span></div>
            <div class="small">SMS notif: <span id="prefSmsView">Off</span></div>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="col-12 col-lg-8">
        <ul class="nav nav-pills mb-3" id="profileTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#overview-pane" type="button">Overview</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#bookings-pane" type="button">Bookings</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#documents-pane" type="button">Documents</button>
          </li>
        </ul>

        <div class="tab-content">
          <!-- Overview -->
          <div class="tab-pane fade show active" id="overview-pane">
            <div class="card shadow-sm mb-3">
              <div class="card-body">
                <h5 class="card-title">Contact details</h5>
                <form id="detailsForm" class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="detailName" class="form-control" value="John Doe" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Contact Number</label>
                    <input type="tel" id="detailNumber" class="form-control" value="+260 123 456 789" required>
                  </div>
                  <div class="col-12">
                    <button class="btn btn-primary btn-sm" type="submit">Save changes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Bookings -->
          <div class="tab-pane fade" id="bookings-pane">
            <div class="card shadow-sm mb-3">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h5 class="card-title mb-0">Your bookings</h5>
                  <button id="addSampleBookingBtn" class="btn btn-outline-primary btn-sm">Add sample booking</button>
                </div>
                <div id="bookingsList" class="list-group small"></div>
                <div id="bookingsEmpty" class="text-muted">No bookings yet.</div>
              </div>
            </div>
          </div>

          <!-- Documents -->
          <div class="tab-pane fade" id="documents-pane">
            <div class="card shadow-sm mb-3">
              <div class="card-body">
                <h5 class="card-title">Travel documents</h5>
                <form id="docForm" class="row g-2 align-items-end">
                  <div class="col-sm-6 col-md-3">
                    <label class="form-label">Type</label>
                    <select id="docType" class="form-select">
                      <option>Passport</option>
                      <option>National ID</option>
                      <option>Visa</option>
                    </select>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <label class="form-label">Number</label>
                    <input id="docNumber" class="form-control" required>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <label class="form-label">Country</label>
                    <input id="docCountry" class="form-control" placeholder="ZM">
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <label class="form-label">Expiry</label>
                    <input id="docExpiry" type="date" class="form-control">
                  </div>
                  <div class="col-12">
                    <button class="btn btn-primary btn-sm" type="submit">Add document</button>
                  </div>
                </form>
                <div id="docsList" class="list-group list-group-flush mt-3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<footer class="main-footer enhanced-footer bg-dark text-white mt-auto">
  <div class="footer-content container py-3">
    <p class="mb-0">&copy; 2025 Zam-Travel. All rights reserved.</p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Avatar preview
  const avatarInput = document.getElementById('avatarInput');
  const avatarImg = document.getElementById('avatarImg');
  avatarInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if(file) avatarImg.src = URL.createObjectURL(file);
  });

  // Sample bookings
  const addBookingBtn = document.getElementById('addSampleBookingBtn');
  const bookingsList = document.getElementById('bookingsList');
  const bookingsEmpty = document.getElementById('bookingsEmpty');
  addBookingBtn.addEventListener('click', () => {
    const booking = document.createElement('li');
    booking.className = 'list-group-item';
    booking.textContent = `Booking #${bookingsList.children.length+1}: Safari to South Luangwa`;
    bookingsList.appendChild(booking);
    bookingsEmpty.style.display = 'none';
  });

    document.addEventListener('DOMContentLoaded', function() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const fallbackBlock = document.querySelector('.section.profile-section');
        const noUserAlert = document.getElementById('noUserAlert');
        function setText(id, value) { const el = document.getElementById(id); if (el) el.textContent = value || '-'; }
        if (currentUser) {
            setText('profileName', currentUser.name);
            setText('profileEmail', currentUser.email);
            setText('profilenumber', currentUser.contactNumber);
            setText('profileNameCard', currentUser.name);
            setText('profileEmailCard', currentUser.email);
            setText('profilenumberCard', currentUser.contactNumber);
            if (noUserAlert) noUserAlert.classList.add('d-none');
        } else {
            if (fallbackBlock) fallbackBlock.style.display = 'block';
            if (noUserAlert) noUserAlert.classList.remove('d-none');
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) logoutBtn.style.display = 'none';
        }
        function handleLogout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'auth.html#login';
        }
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutBtn2 = document.getElementById('logoutBtn2');
        if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
        if (logoutBtn2) logoutBtn2.addEventListener('click', handleLogout);
        const detailsForm = document.getElementById('detailsForm');
        if (detailsForm) detailsForm.addEventListener('submit', function(e) {
            e.preventDefault();
            if (!currentUser) return;
            currentUser.name = document.getElementById('detailName').value.trim();
            currentUser.contactNumber = document.getElementById('detailNumber').value.trim();
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            setText('profileName', currentUser.name);
            setText('profilenumber', currentUser.contactNumber);
            setText('profileNameCard', currentUser.name);
            setText('profilenumberCard', currentUser.contactNumber);
        });
        const avatarInput = document.getElementById('avatarInput');
        if (avatarInput) avatarInput.addEventListener('change', function() {
            const file = this.files && this.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
                const url = ev.target && ev.target.result;
                const img = document.getElementById('avatarImg');
                if (img && typeof url === 'string') img.src = url;
                const meta = JSON.parse(localStorage.getItem('profileMeta') || '{}');
                meta.avatar = url;
                localStorage.setItem('profileMeta', JSON.stringify(meta));
            };
            reader.readAsDataURL(file);
        });
        const meta = JSON.parse(localStorage.getItem('profileMeta') || '{}');
        if (meta.avatar) {
            const img = document.getElementById('avatarImg');
            if (img) img.src = meta.avatar;
        }
        const docForm = document.getElementById('docForm');
        const docsList = document.getElementById('docsList');
        function renderDocs() {
            if (!docsList) return;
            const docs = JSON.parse(localStorage.getItem('profileDocs') || '[]');
            docsList.innerHTML = '';
            docs.forEach((d, idx) => {
                const item = document.createElement('div');
                item.className = 'list-group-item d-flex justify-content-between align-items-center';
                item.innerHTML = `<span><b>${d.type}</b> • ${d.number || ''} • ${d.country || ''} • ${d.expiry || ''}</span>`;
                const del = document.createElement('button');
                del.className = 'btn btn-sm btn-outline-danger';
                del.textContent = 'Delete';
                del.onclick = () => { const cur = JSON.parse(localStorage.getItem('profileDocs') || '[]'); cur.splice(idx,1); localStorage.setItem('profileDocs', JSON.stringify(cur)); renderDocs(); };
                item.appendChild(del);
                docsList.appendChild(item);
            });
        }
        if (docForm) docForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const doc = {
                type: (document.getElementById('docType') || {}).value,
                number: (document.getElementById('docNumber') || {}).value,
                country: (document.getElementById('docCountry') || {}).value,
                expiry: (document.getElementById('docExpiry') || {}).value
            };
            const docs = JSON.parse(localStorage.getItem('profileDocs') || '[]');
            docs.push(doc);
            localStorage.setItem('profileDocs', JSON.stringify(docs));
            renderDocs();
            docForm.reset();
        });
        renderDocs();
        const prefForm = document.getElementById('prefForm');
        function renderPrefs() {
            const prefs = JSON.parse(localStorage.getItem('profilePrefs') || '{}');
            document.getElementById('prefSeat') && (document.getElementById('prefSeat').value = prefs.seat || '');
            document.getElementById('prefMeal') && (document.getElementById('prefMeal').value = prefs.meal || '');
            document.getElementById('prefAccessibility') && (document.getElementById('prefAccessibility').value = prefs.access || '');
            document.getElementById('notifEmail') && (document.getElementById('notifEmail').checked = !!prefs.email);
            document.getElementById('notifSms') && (document.getElementById('notifSms').checked = !!prefs.sms);
            const seatView = document.getElementById('prefSeatView'); if (seatView) seatView.textContent = prefs.seat || '-';
            const mealView = document.getElementById('prefMealView'); if (mealView) mealView.textContent = prefs.meal || '-';
            const emailView = document.getElementById('prefEmailView'); if (emailView) emailView.textContent = prefs.email ? 'On' : 'Off';
            const smsView = document.getElementById('prefSmsView'); if (smsView) smsView.textContent = prefs.sms ? 'On' : 'Off';
        }
        if (prefForm) prefForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const prefs = {
                seat: (document.getElementById('prefSeat') || {}).value,
                meal: (document.getElementById('prefMeal') || {}).value,
                access: (document.getElementById('prefAccessibility') || {}).value,
                email: !!((document.getElementById('notifEmail') || {}).checked),
                sms: !!((document.getElementById('notifSms') || {}).checked)
            };
            localStorage.setItem('profilePrefs', JSON.stringify(prefs));
            renderPrefs();
        });
        renderPrefs();
        const bookingsList = document.getElementById('bookingsList');
        const bookingsEmpty = document.getElementById('bookingsEmpty');
        function renderBookings() {
            if (!bookingsList || !bookingsEmpty) return;
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            bookingsList.innerHTML = '';
            if (bookings.length === 0) { bookingsEmpty.style.display = 'block'; return; }
            bookingsEmpty.style.display = 'none';
            bookings.forEach((b, idx) => {
                const a = document.createElement('a');
                a.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
                a.innerHTML = `<span>${b.tour || b.tourName || 'Tour'} • ${b.date || ''} • ${b.people || 1} people</span>`;
                const del = document.createElement('button');
                del.className = 'btn btn-sm btn-outline-danger';
                del.textContent = 'Remove';
                del.onclick = () => { const cur = JSON.parse(localStorage.getItem('bookings') || '[]'); cur.splice(idx,1); localStorage.setItem('bookings', JSON.stringify(cur)); renderBookings(); };
                a.appendChild(del);
                bookingsList.appendChild(a);
            });
        }
        const addSampleBookingBtn = document.getElementById('addSampleBookingBtn');
        if (addSampleBookingBtn) addSampleBookingBtn.addEventListener('click', function() {
            const sample = { tour: 'Victoria Falls Tour', date: new Date().toISOString().slice(0,10), people: 2 };
            const existing = JSON.parse(localStorage.getItem('bookings') || '[]');
            existing.push(sample);
            localStorage.setItem('bookings', JSON.stringify(existing));
            renderBookings();
        });
        renderBookings();
        const pwdForm = document.getElementById('passwordForm');
        if (pwdForm) pwdForm.addEventListener('submit', function(e) {
            e.preventDefault();
            if (!currentUser) return;
            const cur = (document.getElementById('currentPassword') || {}).value || '';
            const npw = (document.getElementById('newPassword') || {}).value || '';
            const cpw = (document.getElementById('confirmPassword') || {}).value || '';
            if (npw.length < 8 || npw !== cpw || cur !== (currentUser.password || '')) {
                alert('Please check your current password and ensure new passwords match (min 8 chars).');
                return;
            }
            currentUser.password = npw;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            alert('Password updated successfully.');
            pwdForm.reset();
        });
    });
    </script>
</body>
</html> 